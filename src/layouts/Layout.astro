---
import Navbar from "../components/Navbar.jsx";
import Footer from "../components/Footer.jsx";
import AnimatedBackground from "../components/AnimatedBackground.jsx";
import BackToTop from "../components/BackToTop.jsx";
import ScrollObserver from "../components/ScrollObserver.jsx";
import { ClientRouter } from "astro:transitions";
import ProgressBar from "../components/ProgressBar.jsx";
import "../styles/global.css";

const { title, showNavbar = true, isLocked = false } = Astro.props;
const pathname = Astro.url.pathname;
// ... (rest of props logic)
const isLockedPage = isLocked || pathname === "/" || pathname === "/fr" || pathname === "/fr/";

---

<!doctype html>
<html
  lang={Astro.currentLocale ?? "en"}
  class={isLockedPage ? "overflow-hidden" : ""}
>
  <head>
    {/* ... head content ... */}
    <meta charset="UTF-8" />
    <meta name="description" content="Maxence Debes Portfolio" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title}</title>
    <link rel="icon" href="/Neural_network_black.svg" type="image/svg" />
    <ClientRouter />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script is:inline>
      /* ... theme script ... */
      (function () {
        const getTheme = () => {
          if (
            typeof localStorage !== "undefined" &&
            localStorage.getItem("theme")
          ) {
            return localStorage.getItem("theme");
          }
          return "light";
        };
        const theme = getTheme();
        if (theme === "dark") {
          document.documentElement.classList.add("dark");
        } else {
          document.documentElement.classList.remove("dark");
        }
      })();
    </script>
    <script>
       /* ... lenis script ... */
      import Lenis from "lenis";

      const initLenis = () => {
        const lenis = new Lenis();

        function raf(time: number) {
          lenis.raf(time);
          requestAnimationFrame(raf);
        }

        requestAnimationFrame(raf);
      };

      initLenis();

      document.addEventListener("astro:after-swap", initLenis);

      const getTheme = () => {
        if (
          typeof localStorage !== "undefined" &&
          localStorage.getItem("theme")
        ) {
          return localStorage.getItem("theme");
        }
        return "light";
      };

      document.addEventListener("astro:before-swap", (ev) => {
        const theme = getTheme();
        if (theme === "dark") {
          ev.newDocument.documentElement.classList.add("dark");
        } else {
          ev.newDocument.documentElement.classList.remove("dark");
        }
      });
    </script>


    <style>
      :root {
        --nav-h: 70px;
      }

      html {
        font-family: "Poppins", sans-serif;
        overflow-x: hidden;
      }

      #footer-wrapper {
        width: 100%;
        pointer-events: auto;
      }

      main.transition-container {
        position: relative;
        z-index: 10;
        box-sizing: border-box;
      }

      main.transition-container.no-navbar {
      }

      main.transition-container.no-navbar {
        padding-top: 0;
      }

      @media (max-width: 768px) {
        #navbar-wrapper {
          height: var(--nav-h);
        }

        #footer-wrapper {
          padding-top: 10px;
        }
      }
    </style>
  </head>
  <body
    class={`flex flex-col ${isLockedPage ? "h-[100dvh] overflow-hidden" : "min-h-screen"}`}
  >
    <div
      id="background-pattern"
      class="fixed inset-0 -z-50 pointer-events-none"
    >
    </div>

    <AnimatedBackground client:only="react" transition:persist="background" />
    {
      showNavbar && (
        <Navbar
          client:load
          transition:persist="navbar"
          currentPath={Astro.url.pathname}
          currentLocale={Astro.currentLocale}
        />
      )
    }
    <div
      class={`w-full ${isLockedPage ? "h-[170px] md:h-[200px] xl:h-[240px]" : "h-[100px] md:h-[120px]"}`}
    >
    </div>
    <main
      class={`transition-container flex-1 flex flex-col ${!showNavbar ? "no-navbar" : ""}`}
    >
      <slot />
    </main>
    <div
      id="footer-wrapper"
      class={isLockedPage ? "fixed bottom-0 z-20" : ""}
    >
      <Footer client:load />
    </div>
    <BackToTop client:load />
    <ScrollObserver client:only="react" />
    <ProgressBar client:load />
  </body>
</html>
